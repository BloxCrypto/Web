local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

local Options = Library.Options
local Toggles = Library.Toggles

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local TextChatService = game:GetService("TextChatService")

Library.ForceCheckbox = true
Library.ShowToggleFrameInKeybinds = true

local Window = Library:CreateWindow({
    Title = "UNXHub",
    Footer = "Version: " .. (getgenv().unxshared and getgenv().unxshared.version or "Unknown") .. ", Game: " .. (getgenv().unxshared and getgenv().unxshared.gamename or "Unknown") .. ", Player: " .. (getgenv().unxshared and getgenv().unxshared.playername or "Unknown"),
    Icon = 73740010358428,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
	Main = Window:AddTab("Main", "home"),
	Visuals = Window:AddTab("Visuals", "eye"),
	Features = Window:AddTab("Features", "zap"),
	["UI Settings"] = Window:AddTab("UI Settings", "settings"),
}

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local defaultWalkSpeed = 16
local defaultJumpPower = 50
local defaultMaxZoom = 400
local defaultGravity = 196.2
local xrayTransparency = 0.8
local defaultFieldOfView = camera.FieldOfView

local character, humanoid, rootpart

local function getCharacter()
	character = player.Character or player.CharacterAdded:Wait()
	humanoid = character:WaitForChild("Humanoid", 5)
	rootpart = character:WaitForChild("HumanoidRootPart", 5)
	defaultWalkSpeed = humanoid.WalkSpeed
	defaultJumpPower = humanoid.JumpPower
	defaultMaxZoom = player.CameraMaxZoomDistance
	defaultGravity = Workspace.Gravity
end

getCharacter()
player.CharacterAdded:Connect(getCharacter)

local FlyGroupBox = Tabs.Main:AddRightGroupbox("Fly", "plane")

local flySpeed = 5
local flying = false
local bodyVelocity, bodyGyro, flyConnection

local function startFlying()
	if not humanoid or not rootpart then return end
	humanoid.PlatformStand = true
	bodyVelocity = Instance.new("BodyVelocity")
	bodyVelocity.MaxForce = Vector3.new(1e6,1e6,1e6)
	bodyVelocity.Velocity = Vector3.zero
	bodyVelocity.Parent = rootpart
	bodyGyro = Instance.new("BodyGyro")
	bodyGyro.MaxTorque = Vector3.new(1e6,1e6,1e6)
	bodyGyro.P = 10000
	bodyGyro.D = 500
	bodyGyro.Parent = rootpart
	flyConnection = RunService.Heartbeat:Connect(function()
		if not humanoid or not rootpart then return end
		local cm = require(player.PlayerScripts:WaitForChild("PlayerModule",5):WaitForChild("ControlModule",5))
		if not cm then return end
		local mv = cm:GetMoveVector()
		local dir = camera.CFrame:VectorToWorldSpace(mv)
		bodyVelocity.Velocity = dir * (flySpeed*10)
		bodyGyro.CFrame = camera.CFrame
	end)
end

local function stopFlying()
	if humanoid then humanoid.PlatformStand = false end
	if bodyVelocity then bodyVelocity:Destroy() end
	if bodyGyro then bodyGyro:Destroy() end
	if flyConnection then flyConnection:Disconnect() end
	bodyVelocity, bodyGyro, flyConnection = nil,nil,nil
end

FlyGroupBox:AddToggle("Fly", {Text="Fly", Default=false, Callback=function(v)
	flying = v
	if v then startFlying() else stopFlying() end
end})

Toggles.Fly:AddKeyPicker("FlyKeybind", {Default="F", Mode="Toggle", Text="Fly", SyncToggleState=true})

FlyGroupBox:AddSlider("FlySpeed", {Text="Fly Speed", Default=5, Min=1, Max=75, Rounding=0, Callback=function(v) flySpeed = v end})

player.CharacterAdded:Connect(function(c)
	character = c
	humanoid = c:WaitForChild("Humanoid")
	rootpart = c:WaitForChild("HumanoidRootPart")
	if flying then startFlying() end
end)

local LeftMain = Tabs.Main:AddLeftGroupbox("Character", "user")

LeftMain:AddSlider("Walkspeed", {Text="Walkspeed", Default=defaultWalkSpeed, Min=1, Max=500, Rounding=0})
LeftMain:AddSlider("Jumppower", {Text="Jumppower", Default=defaultJumpPower, Min=1, Max=1000, Rounding=0})
LeftMain:AddSlider("MaxZoom", {Text="Max Zoom", Default=defaultMaxZoom, Min=1, Max=1000, Rounding=0})
LeftMain:AddSlider("Gravity", {Text="Gravity", Default=defaultGravity, Min=0, Max=500, Rounding=1})

LeftMain:AddDivider()

LeftMain:AddToggle("InfiniteJump", {Text="Infinite Jump", Default=false})

Toggles.InfiniteJump:AddKeyPicker("InfiniteJumpKeybind", {Default="I", Mode="Toggle", Text="Infinite Jump", SyncToggleState=true})

LeftMain:AddToggle("Noclip", {Text="Noclip", Default=false})

Toggles.Noclip:AddKeyPicker("NoclipKeybind", {Default="N", Mode="Toggle", Text="Noclip", SyncToggleState=true})

LeftMain:AddToggle("ForceThirdPerson", {Text="Force Third Person", Default=false})

LeftMain:AddDivider()

LeftMain:AddToggle("CounterFling", {Text="Counter Fling", Default=false, Callback=function(v)
    if v then
        for _, otherPlayer in ipairs(Players:GetPlayers()) do
            if otherPlayer ~= player and otherPlayer.Character then
                for _, part in ipairs(otherPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end
        
        Players.PlayerAdded:Connect(function(newPlayer)
            if newPlayer.Character then
                for _, part in ipairs(newPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
            newPlayer.CharacterAdded:Connect(function(char)
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end)
        end)
    else
        for _, otherPlayer in ipairs(Players:GetPlayers()) do
            if otherPlayer ~= player and otherPlayer.Character then
                for _, part in ipairs(otherPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end
    end
end})

LeftMain:AddToggle("CounterVoid", {Text="Counter Void", Default=false, Callback=function(v)
    if v then
        getgenv().VoidConnection = RunService.Heartbeat:Connect(function()
            if character and rootpart then
                local voidThreshold = workspace.FallenPartsDestroyHeight or -500
                if rootpart.Position.Y < voidThreshold + 10 then
                    rootpart.Velocity = Vector3.new(rootpart.Velocity.X, 100, rootpart.Velocity.Z)
                end
            end
        end)
    else
        if getgenv().VoidConnection then
            getgenv().VoidConnection:Disconnect()
            getgenv().VoidConnection = nil
        end
    end
end})

LeftMain:AddToggle("NoAFKKick", {Text="No AFK Kick", Default=false, Callback=function(v)
    if v then
        getgenv().AFKConnection = RunService.Heartbeat:Connect(function()
            if player then
                local VirtualInputManager = game:GetService("VirtualInputManager")
                VirtualInputManager:SendMouseMoveEvent(10, 10, game)
                task.wait(1)
                VirtualInputManager:SendMouseMoveEvent(20, 20, game)
            end
        end)
        
        if player then
            local playerScripts = player:FindFirstChild("PlayerScripts")
            if playerScripts then
                local playerModule = playerScripts:FindFirstChild("PlayerModule")
                if playerModule then
                    local controlModule = playerModule:FindFirstChild("ControlModule")
                    if controlModule then
                        getgenv().OriginalControlModule = controlModule:Clone()
                    end
                end
            end
        end
    else
        if getgenv().AFKConnection then
            getgenv().AFKConnection:Disconnect()
            getgenv().AFKConnection = nil
        end
        
        if getgenv().OriginalControlModule and player then
            local playerScripts = player:FindFirstChild("PlayerScripts")
            if playerScripts then
                local playerModule = playerScripts:FindFirstChild("PlayerModule")
                if playerModule then
                    local controlModule = playerModule:FindFirstChild("ControlModule")
                    if controlModule then
                        controlModule:Destroy()
                        getgenv().OriginalControlModule.Parent = playerModule
                    end
                end
            end
            getgenv().OriginalControlModule = nil
        end
    end
end})

LeftMain:AddDivider()

local originalTransparencies = {}
local xrayEnabled = false

LeftMain:AddToggle("XRay", {Text="X-Ray", Default=false, Callback=function(v)
	xrayEnabled = v
	if v then
		originalTransparencies = {}
		for _, obj in ipairs(Workspace:GetDescendants()) do
			if obj:IsA("BasePart") and obj.Parent ~= character then
				originalTransparencies[obj] = obj.Transparency
				obj.Transparency = xrayTransparency
			end
		end
	else
		for obj, originalTransparency in pairs(originalTransparencies) do
			if obj and obj:IsA("BasePart") then
				obj.Transparency = originalTransparency
			end
		end
		originalTransparencies = {}
	end
end})

LeftMain:AddSlider("XRayTransparency", {Text="X-Ray Transparency (%)", Default=80, Min=0, Max=100, Rounding=0, Suffix="%", Callback=function(v)
	xrayTransparency = v/100
	if xrayEnabled then
		for obj, _ in pairs(originalTransparencies) do
			if obj and obj:IsA("BasePart") then
				obj.Transparency = xrayTransparency
			end
		end
	end
end})

local RightMain = Tabs.Main:AddRightGroupbox("Misc", "box")

RightMain:AddButton({Text="Reset Character", Func=function()
	if character then
		character:BreakJoints()
	end
end})

RightMain:AddDivider()

RightMain:AddButton({Text="Reset Walk Speed", Func=function() Options.Walkspeed:SetValue(defaultWalkSpeed) end})
RightMain:AddButton({Text="Reset Jump Power", Func=function() Options.Jumppower:SetValue(defaultJumpPower) end})
RightMain:AddButton({Text="Reset Max Zoom", Func=function() Options.MaxZoom:SetValue(defaultMaxZoom) end})
RightMain:AddButton({Text="Reset Gravity", Func=function() Options.Gravity:SetValue(defaultGravity) end})

local ESPTabBox = Tabs.Visuals:AddLeftTabbox()
local ESPTab = ESPTabBox:AddTab("ESP")
local ESPConfigTab = ESPTabBox:AddTab("Config")
local GameVisuals = Tabs.Visuals:AddRightGroupbox("Game", "camera")

local espColor = Color3.new(1,1,1)
local outlineColor = Color3.new(1,1,1)
local tracersColor = Color3.new(1,1,1)
local outlineFillTransparency = 1
local outlineTransparency = 0
local espSize = 16
local espFont = 1
local showDistance = true
local showPlayerName = true
local rainbowSpeed = 5
local tracerOrigin = "Down"

local highlights = {}
local drawings = {}

local function addPlayer(plr)
	if plr == player then return end
	local function onChar(c)
		if drawings[plr] then drawings[plr].espText:Remove() drawings[plr].tracer:Remove() drawings[plr] = nil end
		if highlights[plr] then highlights[plr]:Destroy() highlights[plr] = nil end
		local hl = Instance.new("Highlight")
		hl.Adornee = c
		hl.Parent = c
		hl.Enabled = false
		highlights[plr] = hl
		local t = Drawing.new("Text")
		t.Visible = false t.Center = true t.Outline = true t.Font = espFont t.Size = espSize t.Color = espColor
		local l = Drawing.new("Line")
		l.Visible = false l.Color = tracersColor l.Thickness = 1
		drawings[plr] = {espText=t, tracer=l}
	end
	if plr.Character then onChar(plr.Character) end
	plr.CharacterAdded:Connect(onChar)
end

for _,p in Players:GetPlayers() do addPlayer(p) end
Players.PlayerAdded:Connect(addPlayer)
Players.PlayerRemoving:Connect(function(plr)
	if highlights[plr] then highlights[plr]:Destroy() highlights[plr] = nil end
	if drawings[plr] then drawings[plr].espText:Remove() drawings[plr].tracer:Remove() drawings[plr] = nil end
end)

local mousePos = Vector2.new()
UserInputService.InputChanged:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseMovement then mousePos = Vector2.new(i.Position.X,i.Position.Y) end
end)

RunService.RenderStepped:Connect(function()
	for plr, hl in pairs(highlights) do
		local char = plr.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		local hum = char and char:FindFirstChild("Humanoid")
		if not char or not hrp or not hum or hum.Health <= 0 then
			hl.Enabled = false
			if drawings[plr] then drawings[plr].espText.Visible = false drawings[plr].tracer.Visible = false end
			continue
		end
		local head = char:FindFirstChild("Head") or hrp
		local headPos = head.Position + Vector3.new(0,2,0)
		local pos3d, onScreen = camera:WorldToViewportPoint(headPos)
		local pos = Vector2.new(pos3d.X, pos3d.Y)
		if not onScreen then
			hl.Enabled = false
			if drawings[plr] then drawings[plr].espText.Visible = false drawings[plr].tracer.Visible = false end
			continue
		end
		if Toggles.Outline and Toggles.Outline.Value then
			hl.Enabled = true
			local c = outlineColor
			if Toggles.OutlineColorFromTeam and Toggles.OutlineColorFromTeam.Value and plr.Team then c = plr.TeamColor.Color end
			if Toggles.RainbowOutline and Toggles.RainbowOutline.Value then c = Color3.fromHSV(tick()*(rainbowSpeed/50)%1,1,1) end
			hl.OutlineColor = c hl.FillColor = c hl.OutlineTransparency = outlineTransparency hl.FillTransparency = outlineFillTransparency
		else
			hl.Enabled = false
		end
		if Toggles.ESP and Toggles.ESP.Value and drawings[plr] then
			local d = drawings[plr].espText
			d.Visible = true
			local c = espColor
			if Toggles.ESPColorFromTeam and Toggles.ESPColorFromTeam.Value and plr.Team then c = plr.TeamColor.Color end
			if Toggles.RainbowESP and Toggles.RainbowESP.Value then c = Color3.fromHSV(tick()*(rainbowSpeed/50)%1,1,1) end
			d.Color = c d.Size = espSize d.Font = espFont d.Position = pos
			local txt = showPlayerName and plr.Name or ""
			if showDistance and rootpart then
				local dist = (rootpart.Position - hrp.Position).Magnitude
				txt = txt .. (txt~="" and " " or "") .. "["..math.floor(dist).." STUDS]"
			end
			d.Text = txt ~= "" and txt or plr.Name
		elseif drawings[plr] then drawings[plr].espText.Visible = false end
		if Toggles.Tracers and Toggles.Tracers.Value and drawings[plr] then
			local t = drawings[plr].tracer
			t.Visible = true
			local c = tracersColor
			if Toggles.TracersColorFromTeam and Toggles.TracersColorFromTeam.Value and plr.Team then c = plr.TeamColor.Color end
			if Toggles.RainbowTracers and Toggles.RainbowTracers.Value then c = Color3.fromHSV(tick()*(rainbowSpeed/50)%1,1,1) end
			t.Color = c
			if tracerOrigin == "Mouse" then t.From = mousePos
			elseif tracerOrigin == "Upper" then t.From = Vector2.new(camera.ViewportSize.X/2,0)
			elseif tracerOrigin == "Middle" then t.From = Vector2.new(camera.ViewportSize.X/2,camera.ViewportSize.Y/2)
			else t.From = Vector2.new(camera.ViewportSize.X/2,camera.ViewportSize.Y) end
			t.To = pos
		elseif drawings[plr] then drawings[plr].tracer.Visible = false end
	end
end)

ESPTab:AddToggle("ESP", {Text="ESP", Default=false}):AddColorPicker("ESPColor", {Default=Color3.new(1,1,1), Title="ESP Color", Callback=function(v) espColor = v end})

ESPTab:AddToggle("Outline", {Text="Outline", Default=false}):AddColorPicker("OutlineColor", {Default=Color3.new(1,1,1), Title="Outline Color", Callback=function(v) outlineColor = v end})

ESPTab:AddToggle("Tracers", {Text="Tracers", Default=false}):AddColorPicker("TracersColor", {Default=Color3.new(1,1,1), Title="Tracers Color", Callback=function(v) tracersColor = v end})

ESPConfigTab:AddToggle("RainbowESP", {Text="Rainbow ESP", Default=false})
ESPConfigTab:AddToggle("RainbowOutline", {Text="Rainbow Outline", Default=false})
ESPConfigTab:AddToggle("RainbowTracers", {Text="Rainbow Tracers", Default=false})
ESPConfigTab:AddSlider("RainbowSpeed", {Text="Rainbow Speed", Min=0, Max=10, Default=5, Rounding=1, Callback=function(v) rainbowSpeed = v end})
ESPConfigTab:AddSlider("ESPSize", {Text="ESP Size", Min=16, Max=50, Default=16, Rounding=0, Callback=function(v) espSize = v end})
ESPConfigTab:AddDropdown("ESPFont", {Text="ESP Font", Values={"UI","System","Plex","Monospace"}, Default=1, Callback=function(v) espFont = ({UI=0,System=1,Plex=2,Monospace=3})[v] or 1 end})
ESPConfigTab:AddToggle("ShowDistance", {Text="Show Distance", Default=true, Callback=function(v) showDistance = v end})
ESPConfigTab:AddToggle("ShowPlayerName", {Text="Show Player Name", Default=true, Callback=function(v) showPlayerName = v end})
ESPConfigTab:AddSlider("OutlineFillTransparency", {Text="Outline Fill Transparency (%)", Min=0, Max=100, Default=100, Suffix="%", Rounding=0, Callback=function(v) outlineFillTransparency = v/100 end})
ESPConfigTab:AddSlider("OutlineTransparency", {Text="Outline Transparency (%)", Min=0, Max=100, Default=0, Suffix="%", Rounding=0, Callback=function(v) outlineTransparency = v/100 end})
ESPConfigTab:AddDropdown("TracersPosition", {Text="Tracers Position", Values={"Mouse","Upper","Middle","Down"}, Default="Down", Callback=function(v) tracerOrigin = v end})
ESPConfigTab:AddToggle("ESPColorFromTeam", {Text="ESP Color From Team", Default=false})
ESPConfigTab:AddToggle("OutlineColorFromTeam", {Text="Outline Color From Team", Default=false})
ESPConfigTab:AddToggle("TracersColorFromTeam", {Text="Tracers Color From Team", Default=false})

local originalLighting = {}
local originalAtmospheres = {}

GameVisuals:AddSlider("FieldOfView", {Text="Field Of View", Default=defaultFieldOfView, Min=60, Max=120, Rounding=0})
GameVisuals:AddToggle("FullBright", {Text="Full Bright", Default=false, Callback=function(v)
	if v then
		originalLighting.Brightness = Lighting.Brightness
		originalLighting.Ambient = Lighting.Ambient
		originalLighting.OutdoorAmbient = Lighting.OutdoorAmbient
		originalLighting.ClockTime = Lighting.ClockTime
		originalLighting.FogEnd = Lighting.FogEnd
		originalLighting.FogStart = Lighting.FogStart
		originalLighting.FogColor = Lighting.FogColor
		
		Lighting.Brightness = 2
		Lighting.Ambient = Color3.fromRGB(255,255,255)
		Lighting.OutdoorAmbient = Color3.fromRGB(255,255,255)
		Lighting.ClockTime = 12
		Lighting.FogEnd = 100000
		Lighting.FogStart = 0
		Lighting.FogColor = Color3.fromRGB(255,255,255)
	else
		if originalLighting.Brightness then
			Lighting.Brightness = originalLighting.Brightness
			Lighting.Ambient = originalLighting.Ambient
			Lighting.OutdoorAmbient = originalLighting.OutdoorAmbient
			Lighting.ClockTime = originalLighting.ClockTime
			Lighting.FogEnd = originalLighting.FogEnd
			Lighting.FogStart = originalLighting.FogStart
			Lighting.FogColor = originalLighting.FogColor
		end
	end
end})
GameVisuals:AddToggle("NoFog", {Text="No Fog", Default=false, Callback=function(v)
	if v then
		originalLighting.FogEnd = Lighting.FogEnd
		originalAtmospheres = {}
		
		for _, obj in ipairs(Workspace:GetDescendants()) do
			if obj:IsA("Atmosphere") then
				originalAtmospheres[obj] = obj.Density
				obj.Density = 0
			end
		end
		Lighting.FogEnd = 100000000
	else
		if originalLighting.FogEnd then
			Lighting.FogEnd = originalLighting.FogEnd
		end
		for atmosphere, originalDensity in pairs(originalAtmospheres) do
			if atmosphere and atmosphere:IsA("Atmosphere") then
				atmosphere.Density = originalDensity
			end
		end
		originalAtmospheres = {}
	end
end})

local AimlockTabbox = Tabs.Features:AddLeftTabbox("Aimlock", "target")
local AimlockTab = AimlockTabbox:AddTab("Aimlock")
local AimlockConfigTab = AimlockTabbox:AddTab("
